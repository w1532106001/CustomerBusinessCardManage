(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/customerList/customerList"],{"05ce":function(o,e,t){"use strict";(function(o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t={data:function(){return{scrollTop:0,old:{scrollTop:0},dataList:[],triggered:!1,show:!1,classList:[],pages:0,_freshing:!1,total:0,baseUrl:"",selectClass:{},userInfo:{}}},onLoad:function(){this.baseUrl=getApp().globalData.baseUrl,this.getUserInfo()},onShow:function(){1==this.userInfo.isBind&&this.fetchClassList()},methods:{upper:function(o){console.log(o)},lower:function(o){console.log(o),this.loadmore()},scroll:function(o){console.log(o),this.old.scrollTop=o.detail.scrollTop},loadmore:function(){this.pages>=this.total||(this.pages++,this.fetchList(!1))},onRefresherpulling:function(){console.log("下拉"),this.onRefresh()},onRefresh:function(){this._freshing||(console.log("刷新"),this._freshing=!0,this.triggered=!0,this.pages=0,this.fetchList(!0))},onPickerCancel:function(){this.show=!1},onPickerConfirm:function(o){this.show=!1,this.selectClass=o.values[0][o.indexs[0]],this.onRefresh()},jumpInputPage:function(){console.log("跳转页面"),this.userInfo.admin?o.navigateTo({url:"/pages/input/input"}):o.showToast({duration:2e3,icon:"error",title:"管理员才可新增"})},jumpClassManagementPage:function(){console.log("跳转页面"),this.userInfo.admin?o.navigateTo({url:"/pages/classManagement/classManagement"}):o.showToast({duration:2e3,icon:"error",title:"管理员才可管理班级"})},clickItem:function(e){console.log("item:"+encodeURIComponent(JSON.stringify(e))),o.navigateTo({url:"/pages/detail/detail?item="+encodeURIComponent(JSON.stringify(e))})},fetchList:function(e){var t=this;console.log("fetchList infos openId:"+this.userInfo.openId),o.request({method:"GET",url:getApp().globalData.baseUrl+"/infos?pos="+this.pages+"&limit=10&classId="+this.selectClass.id,header:{Authorization:this.userInfo.openId},success:function(n){if(e&&(t.triggered=!1,t._freshing=!1),200==n.statusCode){var s=n.data.data;if(t.total=n.data.total,console.log("page "+t.pages+"total:"+t.total),s){e&&(t.dataList=[]);for(var i=0;i<s.length;i++){var r=s[i];t.dataList.push(r)}}else t.dataList=[]}else 403==n.statusCode?o.showToast({icon:"error",title:"没有查看权限",duration:2e3}):e?o.showToast({icon:"error",title:"刷新失败",duration:2e3}):o.showToast({icon:"error",title:"加载失败",duration:2e3})},fail:function(n){console.log(n),e?(t.triggered=!1,t._freshing=!1,o.showToast({icon:"error",title:"刷新失败",duration:2e3})):o.showToast({icon:"error",title:"加载失败",duration:2e3})}})},fetchClassList:function(){var e=this;o.request({method:"GET",url:getApp().globalData.baseUrl+"/class",success:function(t){200==t.statusCode?(console.log("获取班级列表"),e.classList=[],e.classList.push(t.data.data),o.setStorageSync("classList",e.classList),e.classList[0].unshift({id:0,name:"全部"}),e.selectClass=e.classList[0][0],console.log("获取班级列表 onRefresh"),e.onRefresh()):o.showToast({icon:"error",title:"班级列表获取失败",duration:2e3})},fail:function(e){console.log(e),o.showToast({icon:"error",title:"班级列表获取失败",duration:2e3})}})},getUserInfo:function(){var e=this;o.login({provider:"weixin",success:function(t){var n=t.code;o.request({method:"POST",url:getApp().globalData.baseUrl+"/wxLogin",data:{code:n},success:function(t){if(console.log("code:"+n+"resultData:"+JSON.stringify(t)),200==t.statusCode)if(200==t.data.code){var s=t.data.data;console.log("进入登录 data"+JSON.stringify(s)),e.userInfo=s,o.setStorageSync("userInfo",s),e.userInfo.isBind&&(console.log("getUserInfo fetchClassList"),e.fetchClassList())}else o.showToast({icon:"error",title:"用户信息获取失败",duration:2e3});else o.showToast({icon:"error",title:"用户信息获取失败",duration:2e3})},fail:function(e){console.log(e),o.showToast({icon:"error",title:"用户信息获取失败",duration:2e3})}})},fail:function(e){console.log("登录失败：",e),o.showToast({icon:"error",title:"用户信息获取失败",duration:2e3})}})},decryptPhoneNumber:function(e){if("getPhoneNumber:ok"==e.detail.errMsg){var t=e.detail.code;this.bindPhone(t)}else o.showToast({duration:2e3,title:"手机号授权失败",icon:"error"})},bindPhone:function(e){var t=this;console.log("bindPhone code"+e+"openId"+this.userInfo.openId),o.request({method:"POST",url:getApp().globalData.baseUrl+"/bind",data:{code:e,openId:this.userInfo.openId},success:function(e){console.log("bindPhone"+JSON.stringify(e)),200==e.statusCode&&200==e.data.code?(t.userInfo.isBind=!0,t.userInfo.phone=e.data.msg,o.setStorageSync("userInfo",t.userInfo),console.log("bindPhone fetchClassList"),t.fetchClassList()):o.showToast({icon:"error",title:"手机号绑定失败",duration:2e3})},fail:function(e){console.log(e),o.showToast({icon:"error",title:"手机号绑定失败",duration:2e3})}})}}};e.default=t}).call(this,t("543d")["default"])},"444c":function(o,e,t){"use strict";t.r(e);var n=t("05ce"),s=t.n(n);for(var i in n)"default"!==i&&function(o){t.d(e,o,(function(){return n[o]}))}(i);e["default"]=s.a},"79b0":function(o,e,t){"use strict";(function(o){t("c2c7");n(t("66fd"));var e=n(t("dd60"));function n(o){return o&&o.__esModule?o:{default:o}}wx.__webpack_require_UNI_MP_PLUGIN__=t,o(e.default)}).call(this,t("543d")["createPage"])},"7c97":function(o,e,t){"use strict";t.d(e,"b",(function(){return s})),t.d(e,"c",(function(){return i})),t.d(e,"a",(function(){return n}));var n={uRow:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-row/u-row")]).then(t.bind(null,"d2d7"))},uIcon:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(t.bind(null,"3139"))},uPicker:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-picker/u-picker")]).then(t.bind(null,"7be8"))},"u-Image":function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u--image/u--image")]).then(t.bind(null,"e8b4"))},uButton:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-button/u-button")]).then(t.bind(null,"707d"))}},s=function(){var o=this,e=o.$createElement;o._self._c;o._isMounted||(o.e0=function(e){o.show=!0})},i=[]},a75e:function(o,e,t){},cf8d:function(o,e,t){"use strict";var n=t("a75e"),s=t.n(n);s.a},dd60:function(o,e,t){"use strict";t.r(e);var n=t("7c97"),s=t("444c");for(var i in s)"default"!==i&&function(o){t.d(e,o,(function(){return s[o]}))}(i);t("cf8d");var r,a=t("f0c5"),l=Object(a["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],r);e["default"]=l.exports}},[["79b0","common/runtime","common/vendor"]]]);